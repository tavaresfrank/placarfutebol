<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle do Placar</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { margin: 5px; padding: 8px; font-size: 16px; }
    .linha { margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>Controle do Placar</h1>

  <div class="linha">
    <label>Time A: <input type="text" id="timeA" value="Time A"></label>
    <button onclick="mudarPlacar('A',1)">+1</button>
    <button onclick="mudarPlacar('A',-1)">-1</button>
    <span id="golsA">0</span>
  </div>

  <div class="linha">
    <label>Time B: <input type="text" id="timeB" value="Time B"></label>
    <button onclick="mudarPlacar('B',1)">+1</button>
    <button onclick="mudarPlacar('B',-1)">-1</button>
    <span id="golsB">0</span>
  </div>

  <div class="linha">
    <label>Min: <input type="number" id="minutos" value="0"></label>
    <label>Seg: <input type="number" id="segundos" value="0"></label>
  </div>
  
  <div class="linha">
    <button onclick="iniciarTempo()">Start</button>
    <button onclick="pausarTempo()">Pause</button>
    <button onclick="reiniciarTempo()">Reset</button>
  </div>

  <script>
    let golsA = 0, golsB = 0;

    // Função para carregar os dados salvos do servidor
    async function carregarDados() {
      try {
        const res = await fetch("/dados");
        const dados = await res.json();
        
        golsA = dados.golsA;
        golsB = dados.golsB;
        document.getElementById("golsA").textContent = golsA;
        document.getElementById("golsB").textContent = golsB;
        document.getElementById("timeA").value = dados.timeA;
        document.getElementById("timeB").value = dados.timeB;
        document.getElementById("minutos").value = dados.minutos;
        document.getElementById("segundos").value = dados.segundos;

      } catch (e) {
        console.error("Erro ao carregar dados", e);
      }
    }

    // Carrega os dados assim que a página é carregada
    window.onload = carregarDados;

    // Atualiza os gols e envia para o servidor
    function mudarPlacar(time, valor) {
      if(time === "A") {
        golsA = Math.max(0, golsA + valor);
        document.getElementById("golsA").textContent = golsA;
      } else {
        golsB = Math.max(0, golsB + valor);
        document.getElementById("golsB").textContent = golsB;
      }
      enviarDados({ gols: true });
    }

    // Função para enviar os dados para o servidor
    async function enviarDados(opcoes = {}) {
      const dados = {
        timeA: document.getElementById("timeA").value,
        golsA: golsA,
        timeB: document.getElementById("timeB").value,
        golsB: golsB,
        minutos: parseInt(document.getElementById("minutos").value),
        segundos: parseInt(document.getElementById("segundos").value),
        rodando: opcoes.rodando,
        reset: opcoes.reset
      };

      try {
        const res = await fetch("/dados", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(dados),
        });
        const resposta = await res.text();
        console.log(resposta);
      } catch (e) {
        console.error("Erro ao salvar dados", e);
      }
    }

    // Escuta a mudança nos campos de nome para atualizar em tempo real
    document.getElementById("timeA").addEventListener("input", () => enviarDados({ nomes: true }));
    document.getElementById("timeB").addEventListener("input", () => enviarDados({ nomes: true }));

    // Funções para controle do tempo
    function iniciarTempo() {
      enviarDados({ rodando: true });
    }

    function pausarTempo() {
      enviarDados({ rodando: false });
    }

    function reiniciarTempo() {
      document.getElementById("minutos").value = 0;
      document.getElementById("segundos").value = 0;
      enviarDados({ rodando: false, reset: true });
    }
  </script>
</body>
</html>